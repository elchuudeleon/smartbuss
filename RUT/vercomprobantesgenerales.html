 
<?php 

require_once("class/informes.php");

$oControl=new Control(); 

if (!empty($_SESSION['idEmpresa'])) {
  $idEmpresa=$_SESSION['idEmpresa'];
}
if (empty($_SESSION['idEmpresa'])) {
  
  $idEmpresa=$_POST["empresa"];
}
$desde=$_POST["desde"];
$hasta=$_POST["hasta"];


print_r($desde);
print_r('**');
print_r($hasta);
// $filtroCuenta=$_POST["filtroCuenta"];
// print_r($desde);
// print_r($hasta);

$oItem=new Data("empresa","idEmpresa",$idEmpresa);
$aEmpresa=$oItem->getDatos();
// print_r($aBalanceComprobacionT);

$oLista=new Lista("comprobante");
$oLista->setFiltro("fecha",">=",$desde);
$oLista->setFiltro("fecha","<=",$hasta);
$oLista->setFiltro("idEmpresa","=",$idEmpresa);
$comprobante=$oLista->getLista();
unset($oLista);

// print_r($comprobante);

?>

  <div class="card">
    <div class="card-header">
      <table style="font-size: 14px;font-family: Arial;" class="table">
        <tbody >
          <tr>
            <th>AS-SmartBuss</th>
            <th ><img src="<?php echo $URL.$aEmpresa['logo'];?>" width="140" height="100">    <?php echo $aEmpresa['razonSocial'];?></th>
            <th></th>
            <th><?php echo date('Y/m/d'); ?></th>
          </tr>
          <tr>
            <th> </th>
            <th>Nit: <?php echo $aEmpresa['nit'];?> - <?php echo $aEmpresa['digitoVerificador'];?></th>
            <th> </th>
            <th> </th>
          </tr> 
          <tr>
            <th></th>
            <th >COMPROBANTES GENERALES</th>
            <th> </th>
          </tr>
          <tr>
            <th></th>
            <th >DESDE:  <?php echo $desde;?> HASTA: <?php echo $hasta;?></th>
            <th> </th>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-4">
          <a href="filtrarbalancecomprobacion" class="btn btn-info">NUEVO FILTRO</a>
          <input type="hidden" name="empresa" id="empresa" value="<?php echo $aEmpresa['razonSocial'];?>">
          <input type="hidden" name="nitEmpresa" id="nitEmpresa" value="<?php echo $aEmpresa['nit'];?>">
          <input type="hidden" name="logo" id="logo" value="<?php echo $aEmpresa['logo'];?>">
          <input type="hidden" name="digitoVerificador" id="digitoVerificador" value="<?php echo $aEmpresa['digitoVerificador'];?>">
          <input type="hidden" name="url" id="url" value="<?php echo $URL;?>">
          <input type="hidden" name="tipo" id="tipo" value="<?php echo $tipoB;?>">
          <input type="hidden" name="desde" id="desde" value="<?php echo $desde;?>">
          <input type="hidden" name="hasta" id="hasta" value="<?php echo $hasta;?>">
        </div>
      </div>
      <br><br>
                  <?php foreach($comprobante as $key => $value){ 

                    ?>
                  <div class="row">
                    <div class="col-md-12 col-lg-12 table-responsive">
                      <table class="table table-hover table-bordered mayusculas " id="tablecomprobacion" style="font-size: 18px;font-family: 'Arial'; width: 100%;" >
                        <thead>
                          <tr>
                            <th>NIT</th>
                            <th>CUENTA</th>
                            <th>DESCRIPCIÃ“N</th>
                            <th>CENTRO COSTO</th>
                            <th>SUBCENTRO COSTO</th>
                            <th>BASE</th>
                            <th>DETALLE</th>
                            <th>DEBITOS</th>
                            <th>CREDITOS</th>
                          </tr>
                        </thead>
                        <tbody>
                          <?php 
                          $oLista=new Lista("comprobante_items");
                          $oLista->setFiltro("idComprobante","=",$value["idComprobante"]);
                          $comprobanteItems=$oLista->getLista();
                          unset($oLista); 

                          foreach($comprobanteItems as $keyCI => $valueCI){

                            $oItem=new Data("cuenta_contable","idCuentaContable",$valueCI["idCuentaContable"]); 
                            $aCuentaContable=$oItem->getDatos(); 
                            unset($oItem);


                            $oItem=new Data("tercero","idTercero",$valueCI["idTercero"]); 
                                $aTercero=$oItem->getDatos(); 
                                unset($oItem);
                                $nombreTercero=$aTercero["razonSocial"];
                                $nitTercero=$aTercero["nit"];

                            $oItem=new Data("centro_costo","idCentroCosto",$valueCI["idCentroCosto"]); 
                            $aCentroCosto=$oItem->getDatos(); 
                            unset($oItem);

                            $oItem=new Data("subcentro_costo","idSubcentroCosto",$valueCI["idSubcentroCosto"]); 
                            $aSubcentroCosto=$oItem->getDatos(); 
                            unset($oItem);
                          ?>
                          <tr>
                            <td><?php echo $nitTercero ?></td>
                            <td><?php echo $aCuentaContable["codigoCuenta"] ?></td>
                            <td><?php echo $aCuentaContable["nombre"] ?></td>
                            <td><?php echo $aCentroCosto["codigoCentroCosto"] ?></td>
                            <td><?php echo $aSubcentroCosto["codigoSubcentroCosto"] ?></td>
                            <td><?php echo $valueCI["base"] ?></td>
                            <td><?php echo $valueCI["descripcion"] ?></td>
                            <td><?php echo number_format($valueCI["saldoDebito"],2,".",",") ?></td>
                            <td><?php echo number_format($valueCI["saldoCredito"],2,".",",") ?></td>

                            <!-- <td><?php echo number_format($totalDebitos,2,".",",");?></td> -->
                          </tr>
                        <?php } ?>
                        </tbody>
                      </table>
                  </div>
              </div> <?php } ?>
          </div>
      </div>