<?php

require_once("class/empleados.php"); 

$oEmpleados=new Empleados(); 

$oLista=new Lista("proveedor"); 
$aProveedores=$oLista->getLista(); 
unset($oItem);

$oLista=new Lista("empresa"); 
$aEmpresas=$oLista->getLista(); 
unset($oItem);

$oLista=new Lista("factura_compra"); 
$oLista->setFiltro("estado","!=",3); 
$aLista=$oLista->getLista(); 
unset($oItem);

$valorC=0;
foreach ($aLista as $key => $value) {
  $valorC+=$value["subtotal"]; 
}

$oLista=new Lista("factura_venta");  
$aLista2=$oLista->getLista(); 
unset($oItem);

$valorV=0;
foreach ($aLista2 as $key => $value) {
  $valorV+=$value["subtotal"]; 
}


$oLista=new Lista("usuario"); 
$oLista->setFiltro("idRol","IN","1,2");  
$aUsuarios=$oLista->getLista(); 
unset($oItem);

?>
<link rel="stylesheet" href="<?php echo $URL ?>assets/bundles/morris/morris.css">
<link rel="stylesheet" href="<?php echo $URL ?>assets/bundles/summernote/summernote-bs4.css">
<section class="section">
	<ul class="breadcrumb breadcrumb-style ">
      <li class="breadcrumb-item">
        <a href="<?php echo $URL; ?>">
          <i class="fas fa-home"></i></a>
      </li>
      <li class="breadcrumb-item">Inicio</li>
    </ul>
	<div class="section-body">
    
		<div class="row">
      <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="card card-statistic-2">
          <div class="card-icon shadow-primary bg-purple">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="card-wrap float-right">
            <div class="card-header elipsis">
              <h4>Proveedores</h4>
            </div>
            <div class="card-body">
              <?php echo count($aProveedores); ?>
            </div>
          </div>
          <div class="card-chart">
            <canvas id="smallChart1" height="80"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="card card-statistic-2">
          <div class="card-icon shadow-primary bg-orange">
            <i class="fas fa-building"></i>
          </div>
          <div class="card-wrap float-right">
            <div class="card-header">
              <h4>Empresas</h4>
            </div>
            <div class="card-body">
              <?php echo count($aEmpresas); ?>
            </div>
          </div>
          <div class="card-chart">
            <canvas id="smallChart2" height="80"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="card card-statistic-2">
          <div class="card-icon shadow-primary bg-green">
            <i class="fas fa-money-check-alt"></i>
          </div>
          <div class="card-wrap float-right">
            <div class="card-header">
              <h4>Facturas de compra</h4>
            </div>
            <div class="card-body">
              <?php echo "$".number_format($valorC,0,".",","); ?>
            </div>
          </div>
          <div class="card-chart">
            <canvas id="smallChart3" height="80"></canvas>
          </div>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-12">
        <div class="card card-statistic-2">
          <div class="card-icon shadow-primary bg-blue">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="card-wrap float-right">
            <div class="card-header">
              <h4>Facturas de venta</h4>
            </div>
            <div class="card-body">
              <?php echo "$".number_format($valorV,0,".",","); ?>
            </div>
          </div>
          <div class="card-chart">
            <canvas id="smallChart4" height="80"></canvas>
          </div>
        </div>
      </div>
    </div>
		    <div class="row">
		      <div class="col-12 col-md-12 col-lg-12">
		        <div class="card">
		          <div class="card-header">
		            <h4>Facturación general</h4>
		          </div>
		          <div class="card-body">
		            <div id="line_chart" class="graph"></div>
		          </div>
		        </div>
		      </div>
		    </div>
		    <div class="row">
		    <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
              <div class="card">
                <div class="card-header">
                  <h4>Gestión Usuarios</h4>
                </div>
                <div class="card-body">
                  <div class="table-responsive" id="proTeamScroll">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th class="centrar">-</th>
                          <th>Usuario</th>
                          <th>Fecha Registro</th>
                          <th>Estado</th>
                          <th>Empresas</th>
                          <th>Gestión Compras</th>
                        </tr>
                      </thead>
                      <?php foreach($aUsuarios as $aUser){ 
                        $empresasl=array(); 
                        $foto=$aUser['foto']==""?"https://via.placeholder.com/250x250/CCC?text=SIN%20FOTO":$URL.$aUser['foto']; 

                        $oLista=new Lista("usuario_empresa"); 
                        $oLista->setFiltro("idUsuario","=",$aUser["idUsuario"]); 
                        $aEmpresas=$oLista->getLista(); 
                        unset($oItem);

                        foreach($aEmpresas as $iEmpresa){
                          $oItem=new Data("empresa","idEmpresa",$iEmpresa["idEmpresa"]); 
                          $fEmpresa=$oItem->getDatos(); 
                          unset($oItem);

                          if($fEmpresa["logo"]==""){
                            $logo=$aUser['foto']==""?"https://via.placeholder.com/250x250/CCC?text=SIN%20FOTO":$URL.$aUser['foto']; 
                          }else{
                            $logo=$URL.$fEmpresa['logo']; 
                          }

                          $lItem["foto"]=$logo; 
 
                          $empresasl[]=$lItem; 
                        }

                        $iEfectividad["idUsuario"]=$aUser["idUsuario"]; 

                        $efectividad=$oEmpleados->getEfectividadEmpleado($iEfectividad); 
                      ?>
                      <tr>
                        <td class="centrar table-img"><img src="<?php echo $foto; ?>" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13"><?php echo $aUser["nombreUsuario"]; ?></h6>
                          <p class="m-0 font-12">
                            <?php echo $aUser["apellidoUsuario"]; ?>
                          </p>
                        </td>
                        <td><?php echo $aUser["fechaRegistro"]; ?></td>
                        <td><?php echo $aUser["estado"]==1?'Activo':'Inactivo'; ?></td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <?php 
                            $contadorEmpresas=0; 
                            foreach($empresasl as $pos => $lempresa){ 
                            if($pos<3){
                            ?>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="<?php echo $lempresa['foto']; ?>" alt="user" data-toggle="tooltip" title=""
                                data-original-title="<?php echo $lempresa['nombre']; ?>"></li>
                            <?php }else{
                              $contadorEmpresas++; 
                            } } ?>
                            <!-- <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-9.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-10.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li> -->
                            <?php 
                             
                            if($contadorEmpresas>0){
                            ?> 
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+<?php echo $contadorEmpresas; ?></span></li>
                            <?php } ?>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <?php if($aUser["idRol"]!=1){ ?>
                          <div class="progress-text"><?php echo round($efectividad); ?>%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-success" data-width="<?php echo round($efectividad); ?>%"></div>
                          </div>
                          <?php }else{  ?>
                          No Aplica
                          <?php }  ?>
                        </td>
                      </tr>
                      <?php } ?>
                      <!-- <tr>
                        <td class="table-img"><img src="assets/img/users/user-1.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">Android Game App</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Sarah Smith</span>
                          </p>
                        </td>
                        <td>22-05-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-4.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-7.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-2.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">55%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-purple" data-width="55%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-5.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">Java Web Service</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Cara Stevens</span>
                          </p>
                        </td>
                        <td>11-04-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-3.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-7.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-8.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">70%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar" data-width="70%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-9.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">Wedding IOS App</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> John Doe</span>
                          </p>
                        </td>
                        <td>19-05-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-2.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-10.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-4.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">45%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-cyan" data-width="45%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-10.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">Blize Admin Template</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Ashton Cox</span>
                          </p>
                        </td>
                        <td>25-07-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-1.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-5.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-7.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">67%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-red" data-width="67%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-4.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">React js website</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Sarah Smith </span>
                          </p>
                        </td>
                        <td>11-08-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-5.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-8.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-3.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">41%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-orange" data-width="41%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-10.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">SEO improvement</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Janak Gandhi</span>
                          </p>
                        </td>
                        <td>22-02-2018</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-3.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-9.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-1.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">70%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-success" data-width="70%"></div>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td class="table-img"><img src="assets/img/users/user-6.png" alt="">
                        </td>
                        <td>
                          <h6 class="mb-0 font-13">Laravel Website</h6>
                          <p class="m-0 font-12">
                            Assigned to<span class="col-green font-weight-bold"> Mili Rain</span>
                          </p>
                        </td>
                        <td>31-03-2019</td>
                        <td class="text-truncate">
                          <ul class="list-unstyled order-list m-b-0">
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-4.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Wildan Ahdian"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-7.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="John Deo"></li>
                            <li class="team-member team-member-sm"><img class="rounded-circle"
                                src="assets/img/users/user-2.png" alt="user" data-toggle="tooltip" title=""
                                data-original-title="Sarah Smith"></li>
                            <li class="avatar avatar-sm"><span class="badge badge-primary">+4</span></li>
                          </ul>
                        </td>
                        <td class="align-middle">
                          <div class="progress-text">55%</div>
                          <div class="progress" data-height="6">
                            <div class="progress-bar bg-purple" data-width="55%"></div>
                          </div>
                        </td>
                      </tr> -->
                    </table>
                  </div>
                </div>
              </div>
            </div>
		    </div>
	</div>
</section>
<script src="<?php echo $URL ?>assets/bundles/morris/morris.min.js"></script>
<script src="<?php echo $URL ?>assets/bundles/morris/raphael-min.js"></script>
<!-- Page Specific JS File -->
<!-- <script src="<?php echo $URL ?>assets/js/page/chart-morris.js"></script> -->
<!-- <script src="assets/bundles/apexcharts/apexcharts.min.js"></script>
  <script src="assets/bundles/summernote/summernote-bs4.js"></script> -->
  <script src="<?php echo $URL ?>assets/bundles/chartjs/chart.min.js"></script>