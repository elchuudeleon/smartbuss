<?php
date_default_timezone_set("America/Bogota"); 
// $idLibranza=(isset($_REQUEST['id'] ) ? $_REQUEST['id'] : '' );

// if($id==""){

//   echo '<script>window.history.back()</script>'; 

// }
// if(!isset($_SESSION)){ session_start(); }


require_once("class/facturaventa.php");

$desde=$_POST['periodoDesde'];
$hasta=$_POST['periodoHasta'];
$cliente=$_POST['cliente'];


$oCuentasCobrar=new FacturaVenta();
if($cliente ==0){
   

  $aFactura=$oCuentasCobrar->getCuentasCobrar($_SESSION["idEmpresa"],$desde,$hasta);
  unset($oCuentasCobrar);
}else{ 

  $aFactura=$oCuentasCobrar->getCuentasCobrarCliente($_SESSION["idEmpresa"],$cliente,$desde,$hasta);
  unset($oCuentasCobrar);

  $oCliente = new Data("cliente","idCliente",$cliente);
  $aCliente=$oCliente->getDatos();
  unset($oCliente);
}


?>


      <div class="section-body">

          <div class="row">

            <div class="col-md-12 col-lg-12">

              <div class="card">

                <div class="card-header">

                  <h4>Informaci√≥n General</h4>

                </div>

                <div class="card-body">

                  <div class="row">

                    <div class="col-md-12 col-lg-12">

                      <table class="table table-striped mayusculas" id="tableEnterprise">

                        <thead>

                          <tr>

                            <th class="text-center">#</th>
                            
                            <th>Nro factura</th>

                            <th>Cliente</th>

                            <th>Fecha factura</th>

                            <th>Fecha vencimiento</th>

                            <th>Total</th>

                            <th>Acciones</th>

                          </tr>

                        </thead>

                        <tbody>

                          <?php foreach($aFactura as $index => $iFactura){ 



                          $oItem=new Data("cliente","idCliente", $iFactura["idCliente"]); 

                          $aCliente=$oItem->getDatos(); 

                          unset($oItem); 

                            ?> 

                            <tr>

                              <td><?php echo $index+1; ?></td>

                              <td><?php echo $iFactura["nroFactura"]; ?></td>

                              <td><?php echo $aCliente["razonSocial"]; ?></td>

                              <td><?php echo $iFactura["fechaFactura"]; ?></td>

                              <td><?php echo $iFactura["fechaVencimiento"]; ?></td>

                              <td><?php echo "$".number_format($iFactura["total"],2,",","."); ?></td>
                          
                              <td class="centrar">                  
                                <a href="<?php echo $URL.$iFactura['archivo']; ?>" target="_blank" data-toggle="tooltip" data-placement="top" title="Ver factura" class="btn btn-icon btn-sm btn-warning"><i class="fas fa-file"></i></a>
                              </td>
                            </tr>

                          <?php } ?>

                        </tbody>

                      </table>

                    </div>

                  </div>

                  <a href="filtrarcuentascobrar" type="button" class="btn btn-info">Nuevo filtro</a>
                  </div>

                </div>

            </div>

        </div>

    </div>


<script>
function imprim2(){
    var mywindow = window.open('', 'PRINT');
    mywindow.document.write('<html><head>');
  mywindow.document.write('<style>.table-striped thead{background-color: #87BFFE; color: white; font-size: 20px;}</style>');
    mywindow.document.write('</head><body >');

    mywindow.document.write(document.getElementById('muestra').innerHTML);
    mywindow.document.write('</body></html>');
    mywindow.document.close(); 
    mywindow.focus(); 
    mywindow.print();
    
    
    return true;}

    $('[data-toggle="tooltip"]').tooltip();
</script> 